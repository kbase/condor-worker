# This checks if the node is healthy and reports to slack if it is not. Sets NODE_IS_HEALTHY to True or False
STARTD_CRON_NodeHealth_EXECUTABLE = /kb/deployment/bin/cron/health_check.py
STARTD_CRON_NodeHealth_PERIOD = 6m
STARTD_CRON_NodeHealth_MODE = Periodic
STARTD_CRON_NodeHealth_RECONFIG_RERUN = True
STARTD_CRON_NodeHealth_ENV = "SLACK_WEBHOOK_URL={{ .Env.SLACK_WEBHOOK_URL }} SERVICE_ENDPOINT={{ .Env.SERVICE_ENDPOINT }} CONDOR_SUBMIT_WORKDIR={{ .Env.CONDOR_SUBMIT_WORKDIR }} DOCKER_CACHE={{ .Env.DOCKER_CACHE }} EXECUTE_SUFFIX={{ .Env.EXECUTE_SUFFIX }} CHECK_CONDOR_STARTER_HEALTH={{ .Env.CHECK_CONDOR_STARTER_HEALTH }} DEBUG={{ .Env.DEBUG }}"


# startd hook to delete exited containers (Might want to leave this longer for debugging)
STARTD_CRON_DeleteExitedContainers_EXECUTABLE = /kb/deployment/bin/cron/delete_exited_containers.py
STARTD_CRON_DeleteExitedContainers_PERIOD = 30m
STARTD_CRON_DeleteExitedContainers_MODE = Periodic
STARTD_CRON_DeleteExitedContainers_RECONFIG_RERUN = True
STARTD_CRON_DeleteExitedContainers_ENV = "SLACK_WEBHOOK_URL={{ .Env.SLACK_WEBHOOK_URL }}"

# Container Reaper EE2
#STARTD_CRON_EE2ContainerREAPER = /kb/deployment/bin/cron/container_reaper_ee2.py
#STARTD_CRON_EE2ContainerREAPER_PERIOD = 6m
#STARTD_CRON_EE2ContainerREAPER_MODE = Periodic
#STARTD_CRON_EE2ContainerREAPER_RECONFIG_RERUN = True
#STARTD_CRON_EE2ContainerREAPER_ENV = "EE2_ENDPOINT={{ .Env.EE2_ENDPOINT }} SLACK_WEBHOOK_URL={{ .Env.SLACK_WEBHOOK_URL }} SERVICE_ENDPOINT={{ .Env.SERVICE_ENDPOINT }} CONDOR_SUBMIT_WORKDIR={{ .Env.CONDOR_SUBMIT_WORKDIR }} DELETE_ABANDONED_CONTAINERS={{ .Env.DELETE_ABANDONED_CONTAINERS }}"

# Container Reaper Version 2024
STARTD_CRON_EE2ContainerREAPER = /kb/deployment/bin/cron/container_reaper.py
STARTD_CRON_EE2ContainerREAPER_PERIOD = 6m
STARTD_CRON_EE2ContainerREAPER_MODE = Periodic
STARTD_CRON_EE2ContainerREAPER_RECONFIG_RERUN = True
STARTD_CRON_EE2ContainerREAPER_ENV = "SLACK_WEBHOOK_URL={{ .Env.SLACK_WEBHOOK_URL }} CONTAINER_REAPER_ENDPOINTS={{ .Env.EE2_REAPER_ENDPOINTS }} DELETE_ABANDONED_CONTAINERS={{ .Env.DELETE_ABANDONED_CONTAINERS }}"


# Tmpwatch $CONDOR_SUBMIT_WORKDIR
STARTD_CRON_ManageCondorSubmitWorkdir_EXECUTABLE = /usr/sbin/tmpwatch
STARTD_CRON_ManageCondorSubmitWorkdir_ARGS = 14d $CONDOR_SUBMIT_WORKDIR
STARTD_CRON_ManageCondorSubmitWorkdir_PERIOD = 24h
STARTD_CRON_ManageCondorSubmitWorkdir_MODE = Periodic
STARTD_CRON_ManageCondorSubmitWorkdir_RECONFIG_RERUN = True
STARTD_CRON_ManageCondorSubmitWorkdir_ENV = "CONDOR_SUBMIT_WORKDIR={{ .Env.CONDOR_SUBMIT_WORKDIR }} "

# Prune docker every 14 days
STARTD_CRON_ManageVarLibDocker_EXECUTABLE = /usr/bin/docker
STARTD_CRON_ManageVarLibDocker_ARGS = system prune -a -f
STARTD_CRON_ManageVarLibDocker_PERIOD = 336h
STARTD_CRON_ManageVarLibDocker_MODE = Periodic
STARTD_CRON_ManageVarLibDocker_RECONFIG_RERUN = True

STARTD_CRON_JOBLIST = NodeHealth EE2ContainerREAPER ManageVarLibDocker ManageCondorSubmitWorkdir
# STARTD_CRON_AUTOPUBLISH = If_Changed
